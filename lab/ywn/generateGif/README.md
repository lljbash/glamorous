# 线稿绘制算法

## 提取线稿的算法
 - 该算法是一种图形学算法（区别于神经网络），速度快效果好。具体分为以下几个步骤：
 - 给定原图 src，
	 - 将原图反相得到 mask
	 - 将mask转化为minmap，minmap中像素点的取值为：以mask对应像素点为中心的5*5小方块中的最小值
	 - 根据公式：lightmap(i, j) = src(i, j) + [src(i, j) * minmap(i, j)] / (255 - minmap(i, j)) 得到 lightmap
	 - 去噪，对mask中每个像素点，如果周围八个像素点和它自己的灰度差值均小于2，则 res(i, j) = 255，否则 res(i, j) = lightmap(i, j)

## 得到线稿之后，我们用如下算法模拟产生线稿生成的中间过程图：
 - 算法整体为思路为在一张空白的纸上一笔一笔将线画上去，从而生成线稿的中间图，而绘画的过程是一个递归过程。
 - 在线稿图上选定一个起始点，该点被选入当前要画上去的一笔的集合中；然后考察该点上下左右的四个点，选出颜色最深（即最黑）的点，作为下一次递归函数被调用的起始点；整个递归过程中记录访问过的点，当当前点上下左右四个点均被访问过的时候，递归过程终止。由于始终沿着颜色最深的方向前进，因此我们有理由期望该过程会得到一条近似轮廓线的线，并绘制在白纸上。
 - 上述为绘制一笔的过程，在整张线稿被绘出前，上述过程会被多次重复。在起始点的选取上，我们采用在上一次终止点的周围进行选取的策略。这样做可以使笔画之间具有一定的局部性与连续性，使得过程更像人类绘画的过程。
实现的部分代码及功能”如下：
 - main函数中递归调用部分的代码，第一笔的起始位置是随机选取的，go函数是绘制一笔的函数，会返回这一笔的终点，getNextPoint函数返回下一笔的起始位置。while中的每一次循环会在画布上画上一笔，在99.9%的点被绘制上去之前，该过程会一直持续下去：
 - go函数是递归实现的，每次被调用都会绘制一个点，递归结束时实现了绘制一笔。(x, y)为绘制点的坐标；resMat为画布矩阵，在每次递归中都被绘制；deep为递归深度，最终递归结束时该值为这一笔中包含的点数，点数小于一定阈值时，这一笔会被并入下一笔。
 - getNextPoint函数实现的功能为，根据传入的点的坐标，找到最近的矩形区域内尚未被访问过的点，作为下一笔的起始点。
